CREATE VIEW V_MEJOR_CURSO(
PERIODO, CICLO, IDCURSO, NOMCURSO, SECCIONES, MATRICULADOS
)AS
WITH V_PREVIA AS(
	SELECT CICLO, MAX(MATRICULADOS) MATRICULADOS
	FROM V_RESUMEN_CURSO
	GROUP BY CICLO)
SELECT R.PERIODO, R.CICLO, R.IDCURSO, R.NOMCURSO, R.SECCIONES, R.MATRICULADOS
FROM V_RESUMEN_CURSO R
JOIN V_PREVIA P 
ON R.CICLO = P.CICLO AND R.MATRICULADOS = P.MATRICULADOS;


SELECT * FROM V_MEJOR_CURSO
WHERE PERIODO = '2017'
ORDER BY CICLO, IDCURSO;
GO

